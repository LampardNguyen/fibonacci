angular.module("starter").controller("addNewWordCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonSql","$DTA","$commonFunc","$ionicFilterBar","$tableName","$cordovaToast",function($rootScope,$scope,$commonModel,$timeout,$commonSql,$DTA,$commonFunc,$ionicFilterBar,$tableName,$cordovaToast){$scope.model=$commonModel,$scope.init=function(){$scope.model.search.$="",$scope.model.newWordList=[],$scope.model.newWordListTmp=[],$scope.resetAddNewWords()},$scope.resetAddNewWords=function(){$timeout(function(){$scope.model.english=null,$scope.model.vietnamese=null,$scope.model.example=null,angular.isDefined($scope.addNewWordsForm)&&$scope.addNewWordsForm.$setUntouched()},100)},$scope.AddNewWords=function(){$commonFunc.getNextIdOfTable($tableName.Words,function(e){var o={isDeleted:"",deletedBy:"",createdBy:$scope.model.currentUser.idOffline,idOffline:e,english:$scope.model.english,vietnamese:$scope.model.vietnamese,example:$scope.model.example,isLearned:0};$DTA.insertDataToTable($scope.model.db,$tableName.Words,o);var n={isDeleted:"",deletedBy:"",createdBy:$scope.model.currentUser.idOffline,classId:$scope.model.currentClass.idOffline,wordId:e};$DTA.insertDataToTable($scope.model.db,$tableName.ClassesWords,n),$scope.model.currentClass.vocabulary.push(o),$scope.model.newWordList.push(o),$scope.model.newWordListTmp.push(o),$scope.resetAddNewWords(),$("#inputFirst").focus()})},$scope.initAddNewWordsForm=function(e){$timeout(function(){$scope.addNewWordsForm=e.addNewWordsForm},100)},$scope.chooseFile=function(){$("#chooseFile").trigger("click")},$scope.endChooseFile=function(e){$scope.model.loading.show(),$scope.model.newWordListTmp=[],$scope.model.wordIdCount=null,$scope.insertDataWhenImport(e,0,e.length)},$scope.insertDataWhenImport=function(e,o,n){if(n==o)return $scope.model.newWordList=angular.copy($scope.model.newWordListTmp),$scope.model.currentClass.vocabulary=angular.copy($scope.model.newWordListTmp),void $scope.model.loading.hide();var s=e[o],d=s[0].trim()+" ("+s[1].trim()+")",t=s[2].trim(),l=angular.isDefined(s[3])?s[3].trim():null;s[1].trim().indexOf("(")!=-1&&(d=s[0].trim()+" "+s[1].trim());var r={idOffline:$scope.model.wordIdCount,english:d,vietnamese:t,example:l,isLearned:0,isDeleted:"",deletedBy:"",createdBy:$scope.model.currentUser.idOffline,isSync:!1},i={classId:$scope.model.currentClass.idOffline,wordId:$scope.model.wordIdCount,isDeleted:"",deletedBy:"",createdBy:$scope.model.currentUser.idOffline,isSync:!1};null===$scope.model.wordIdCount?$commonFunc.getNextIdOfTable($tableName.Words,function(s){r.idOffline=s,i.wordId=s,$scope.model.wordIdCount=s+1,$DTA.importWordsClasses_words($scope.model.db,r,i,n,o),$scope.model.newWordListTmp.push(r),$scope.insertDataWhenImport(e,++o,n)}):($DTA.importWordsClasses_words($scope.model.db,r,i,n,o),$scope.model.wordIdCount++,$scope.model.newWordListTmp.push(r),$scope.insertDataWhenImport(e,++o,n))},$scope.showFilterBar=function(){$ionicFilterBar.show({items:$scope.model.newWordList,update:function(e,o){$scope.model.newWordList=e,$scope.model.search.$=o}})},$scope.inputSpeech=function(modelName,language){if("webkitSpeechRecognition"in window){$scope.model.loading.show({template:'<span class="ion-ios-mic-outline"></span>'});var recognition=new webkitSpeechRecognition;recognition.lang=language,recognition.onresult=function(event){event.results.length>0&&(eval("!$scope.model."+modelName)&&eval("$scope.model."+modelName+' = ""'),eval("$scope.model."+modelName+" += event.results[0][0].transcript"),$scope.model.loading.hide())},recognition.onerror=function(e){$scope.model.loading.hide()},recognition.start(),$timeout(function(){$scope.model.loading.hide()},1e4)}else $cordovaToast.show("Sorry, your Device does not support the Speech API","short","bottom")}}]),angular.module("starter").directive("fileReader",function(){return{scope:{fileReader:"=",change:"&"},link:function(e,o){angular.element(o).on("change",function(n){if(n.target.value.lastIndexOf(".txt")!=-1){var s=n.target.files;if(s.length){var d=new FileReader;d.onload=function(n){var s=n.target.result.trim();e.$apply(function(){e.fileReader=s.replace(/"/g," ");var n=e.fileReader.split("\n"),d=[];angular.forEach(n,function(e){d.push(e.split("|"))}),e.change({arr:d}),o.val("")})},d.readAsText(s[0])}}})}}});
angular.module("starter").controller("allWordOfClassCtrl",["$rootScope","$scope","$commonModel","$timeout","$ionicModal","$DTA","$ionicPopup","$ionicListDelegate","$ionicFilterBar","$commonFunc","$tableName",function($rootScope,$scope,$commonModel,$timeout,$ionicModal,$DTA,$ionicPopup,$ionicListDelegate,$ionicFilterBar,$commonFunc,$tableName){$scope.model=$commonModel,$scope.init=function(){$scope.model.loading.show(),$scope.model.currentClass.vocabulary=null,$scope.model.search.$=""},$scope.selectRemoveWord=function(e){angular.isUndefined($scope.showConfirmRemoveWord)&&($scope.showConfirmRemoveWord=function(e){var o=$ionicPopup.confirm({title:"Warnig",template:"Are you sure want to remove this word?"});o.then(function(o){o&&($scope.removeWords(e),$ionicListDelegate.closeOptionButtons())})}),$scope.showConfirmRemoveWord(e)},$scope.showModalUpdateWords=function(e){$scope.model.currentWord=e,$scope.resetUpdateWords(e),$scope.updateWordsModal?$scope.updateWordsModal.show():$ionicModal.fromTemplateUrl("./templates/updateWords.html",function(e){$scope.updateWordsModal=e,$scope.updateWordsModal.show()},{scope:$scope,animation:"slide-in-up",focusFirstInput:!0,backdropClickToClose:!1,hardwareBackButtonClose:!0})},$scope.removeWords=function(e){var o={wordId:e.idOffline};$DTA.deleteTable($scope.model,$tableName.ClassesWords,o);var s=_.findIndex($scope.model.currentClass.vocabulary,function(o){return o.idOffline==e.idOffline});$scope.model.currentClass.vocabulary.splice(s,1)},$scope.initUpdateWordsForm=function(e){$timeout(function(){$scope.updateWordsForm=e.updateWordsForm},100)},$scope.updateWords=function(){var e={english:$scope.model.english,vietnamese:$scope.model.vietnamese,example:$scope.model.example},o={idOffline:$scope.model.currentWord.idOffline};$DTA.updateTable($scope.model.db,$tableName.Words,e,o),$scope.model.currentWord.english=$scope.model.english,$scope.model.currentWord.vietnamese=$scope.model.vietnamese,$scope.model.currentWord.example=$scope.model.example,$scope.closeUpdateWords(),$ionicListDelegate.closeOptionButtons()},$scope.closeUpdateWords=function(){$scope.updateWordsModal.hide()},$scope.resetUpdateWords=function(e){$timeout(function(){$scope.model.english=e.english,$scope.model.vietnamese=e.vietnamese,$scope.model.example=e.example,angular.isDefined($scope.updateWordsForm)&&$scope.updateWordsForm.$setUntouched()},100)},$scope.showFilterBar=function(){$ionicFilterBar.show({items:$scope.model.currentClass.vocabulary,update:function(e,o){$scope.model.currentClass.vocabulary=e}})},$scope.inputSpeech=function(modelName,language){$scope.model.loading.show({template:'<span class="ion-ios-mic-outline"></span>'});var recognition=new webkitSpeechRecognition;recognition.lang=language,recognition.onresult=function(event){event.results.length>0&&(eval("$scope.model."+modelName+" = event.results[0][0].transcript"),$scope.model.loading.hide())},recognition.onerror=function(e){$scope.model.loading.hide()},recognition.start()}}]);
angular.module("starter").controller("classContentCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonFunc","$ionicPopup","$DTA","$tableName",function(e,s,o,n,l,t,a,r){s.model=o,s.showModalAddNewWords=function(){l.setView("#/addNewWords")},s.showCreateLesson=function(){l.setView("#/createLesson"),s.getWordOfClass(0)},s.showDoExcercises=function(){s.getLessonOfClass(s.model.currentClass),l.setView("#/listDoExercises")},s.showWordsNotLearnYet=function(){s.model.loading.show(),l.setView("#/wordsNotLearnYet"),n(function(){s.getWordOfClass(0)})},s.showAllWordOfClass=function(){s.getWordOfClass(),l.setView("#/allWordOfClass")},s.showManageLessons=function(){s.getLessonOfClass(s.model.currentClass),l.setView("#/manageLessons")},s.getLessonOfClass=function(e){e.lessons=[];var o={classId:e.idOffline};a.selectTableWhere(s.model.db,r.ClassesLessons,o).then(function(o){_.each(o.rows,function(o){var n={idOffline:o.lessonId};a.selectTableWhere(s.model.db,r.Lessons,n).then(function(s){e.lessons.push(s.rows[0])},function(e){})})},function(e){console.log(e)})},s.selectRemoveClass=function(e){event.stopPropagation(),angular.isUndefined(s.showConfirmRemoveClass)&&(s.showConfirmRemoveClass=function(e){var o=t.confirm({title:"Warnig",template:"Are you sure want to remove this class?"});o.then(function(o){o&&(s.model.loading.show(),l.removeClass(e,!0),l.setView("#/main"))})}),s.showConfirmRemoveClass(e)},s.getWordOfClass=function(e){s.model.currentClass.vocabulary=[];var o={classId:s.model.currentClass.idOffline};a.selectTableWhere(s.model.db,r.ClassesWords,o).then(function(o){if(0==o.rows.length)return s.model.loading.hide(),void(s.model.currentClass.vocabulary=[]);var n=[];_.each(o.rows,function(e){n.push([e.wordId])}),a.selectAllWordsOfClasses(s.model.db,n,e).then(function(e){s.model.currentClass.vocabulary=e,s.model.loading.hide()},function(e){console.log(e)}),n=[]},function(e){console.log(e)})}}]);
angular.module("starter").controller("createLessonCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonSql","$DTA","$commonFunc","$ionicPopup","$ionicFilterBar","$tableName",function(e,n,o,s,r,l,a,t,d,c){n.model=o,n.init=function(){n.model.loading.show(),n.model.currentClass.vocabulary=null,n.model.countWordsOfLesson=5,n.resetCreateLesson()},n.resetCreateLesson=function(){n.model.lessonName=null,delete n.model.errorLessonName},n.createLesson=function(){n.model.errorLessonName=!1,n.model.errorLessonListWord=!1;var e=n.model.currentClass.vocabulary.every(function(e){return 1!=e.isChecked});return null==n.model.lessonName||""==n.model.lessonName||e?(null!=n.model.lessonName&&""!=n.model.lessonName||(n.model.errorLessonName=!0),void(e&&(n.model.errorLessonListWord=!0))):void a.getNextIdOfTable(c.Lessons,function(e){var o={idOffline:e,name:n.model.lessonName,state:0,learnStartDate:"",relearnDate:"",nextLearnDate:"",nextFibonaci:3,isLearned:0,countLearn:0,isDeleted:"",deletedBy:"",createdBy:n.model.currentUser.idOffline};l.insertDataToTable(n.model.db,c.Lessons,o);var s={classId:n.model.currentClass.idOffline,lessonId:e,isDeleted:"",deletedBy:"",createdBy:n.model.currentUser.idOffline};l.insertDataToTable(n.model.db,c.ClassesLessons,s);var r={idOffline:e,name:n.model.lessonName,state:0};n.model.currentClass.lessons.push(r),n.model.currentLesson=r;var a=[],t=[];n.model.currentClass.vocabulary.forEach(function(o,s){if(1==o.isChecked&&(angular.isUndefined(o.lessonId)||null==o.lessonId)){var d=Parse.Object.extend(c.Words),i=new Parse.Query(d);i.get(o.idOnline,{success:function(e){e.set("isLearned","1"),e.save()},error:function(e,n){}}),o.isLearned=1,o.lessonId=r.idOffline,a.push({idOffline:o.idOffline,english:o.english,vietnamese:o.vietnamese,example:o.example});var u={lessonId:e,wordId:o.idOffline,isDeleted:"",deletedBy:"",createdBy:n.model.currentUser.idOffline};l.insertDataToTable(n.model.db,c.LessonsWords,u),t.push(s)}}),t.forEach(function(e,o){n.model.currentClass.vocabulary.splice(e-o,1)}),r={idOffline:e,name:n.model.lessonName,vocabulary:a,learnStartDate:null,relearnDate:null,nextLearnDate:null,nextFibonaci:3,isLearned:0,state:0,countLearn:0},n.model.lessonList.push(r),n.resetCreateLesson(),n.confirmLearnNow()})},n.confirmLearnNow=function(){var e=t.confirm({title:"Create done!",template:"Are you sure you want to learn now?"});e.then(function(e){e&&a.setView("#/mainLesson")})},n.changeCountWordOfLesson=function(){n.model.currentClass.vocabulary.forEach(function(e){1==e.isChecked&&1!=e.isLearned&&(e.isChecked=!1)});for(var e=0,o=0;o<n.model.vocabularyCreateLesson.length;o++){n.model.vocabularyCreateLesson[o].isChecked=!0;for(var s=n.model.currentClass.vocabulary.length-1;s>=0;s--)if(n.model.currentClass.vocabulary[s].idOffline==n.model.vocabularyCreateLesson[o].idOffline){n.model.currentClass.vocabulary[s].isChecked=!0;break}if(++e,e==n.model.countWordsOfLesson||e==n.model.currentClass.vocabulary.length)break}},n.countCheck=function(){angular.isUndefined(n.model.currentClass)||(n.model.countWordsOfLesson=_.countBy(n.model.currentClass.vocabulary,function(e){return 1==e.isChecked&&1!=e.isLearned?"length":"null"}).length)},n.changeCountWordOfLesson=function(){n.model.currentClass.vocabulary.forEach(function(e){1==e.isChecked&&1!=e.isLearned&&(e.isChecked=!1)});for(var e=0,o=0;o<n.model.vocabularyCreateLesson.length;o++){n.model.vocabularyCreateLesson[o].isChecked=!0;for(var s=n.model.currentClass.vocabulary.length-1;s>=0;s--)if(n.model.currentClass.vocabulary[s].idOffline==n.model.vocabularyCreateLesson[o].idOffline){n.model.currentClass.vocabulary[s].isChecked=!0;break}if(++e,e==n.model.countWordsOfLesson||e==n.model.currentClass.vocabulary.length)break}},n.showFilterBar=function(){d.show({items:n.model.currentClass.vocabulary,update:function(e,o){n.model.currentClass.vocabulary=e}})}}]);
angular.module("starter").controller("doExercisesNeedListCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonFunc",function(o,e,n,s,t){e.model=n,e.init=function(){e.model.search.$=""},e.chooseLesson=function(o,n){e.model.currentLesson=o,t.getWordsOfLesson(),t.setView("#/mainLesson"),n||e.toggleLeft()}}]);
angular.module("starter").controller("listDoExercisesCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonSql","$DTA","$commonFunc","$ionicFilterBar",function(o,e,s,n,t,l,r,c){e.model=s,e.init=function(){e.model.search.$=""},e.chooseLesson=function(o,s){e.model.currentLesson=o,r.getWordsOfLesson(),r.setView("#/mainLesson"),s||e.toggleLeft()},e.showFilterBar=function(){c.show({items:e.model.currentClass.lessons,update:function(o,s){e.model.currentClass.lessons=o}})}}]);
angular.module("starter").controller("mainLessonCtrl",["$rootScope","$scope","$commonModel","$timeout","$commonFunc",function(o,e,n,r,t){e.model=n,e.startLearnVocabulary=function(){r(function(){var o=e.model.lessonList.filter(function(o){return o.idOffline==e.model.currentLesson.idOffline});null!=o&&o.length>0&&(e.model.wordList=o[0].vocabulary),e.model.wordList.forEach(function(o){o.isRemember=0})}),t.setView("#/wordListLearn")}}]);
angular.module("starter").controller("manageLessonsCtrl",["$rootScope","$scope","$commonModel","$ionicPopup","$ionicListDelegate","$DTA","$ionicFilterBar","$tableName",function(e,n,o,s,t,a,i,l){n.model=o,n.init=function(){n.model.search.$=""},n.resetLesson=function(e){e.countLearn=0,e.isLearned=0,e.learnStartDate="",e.nextFibonaci=3,e.nextLearnDate="",e.relearnDate="",e.state=0;var o={countLearn:0,isLearned:0,learnStartDate:"",nextFibonaci:3,nextLearnDate:"",relearnDate:"",state:0},s={idOffline:e.idOffline};a.updateTable(n.model.db,"Lessons",o,s)},n.showPopupRenameLesson=function(e){s.prompt({title:"Rename lesson",inputType:"text",inputPlaceholder:"Enter new lesson"}).then(function(o){angular.isUndefined(o)||null==o||""==o||(angular.isUndefined(n.renameLesson)&&(n.renameLesson=function(e){var s={name:o},i={idOffline:e.idOffline};a.updateTable(n.model.db,"Lessons",s,i),e.name=o,n.shownGroup=null,t.closeOptionButtons()}),n.renameLesson(e))})},n.selectRemoveLesson=function(e){angular.isUndefined(n.showConfirmRemoveLesson)&&(n.showConfirmRemoveLesson=function(e){var o=s.confirm({title:"Warnig",template:"Are you sure want to remove this lesson?"});o.then(function(o){o&&(n.removeLesson(e),t.closeOptionButtons())})}),n.showConfirmRemoveLesson(e)},n.removeLesson=function(e){var o={lessonId:e.idOffline};a.deleteTable(n.model,l.ClassesLessons,o);var s=_.findIndex(n.model.currentClass.lessons,function(n){return n.idOffline==e.idOffline});n.model.currentClass.lessons.splice(s,1)},n.showFilterBar=function(){i.show({items:n.model.currentClass.lessons,update:function(e,o){n.model.currentClass.lessons=e}})}}]);
angular.module("starter").controller("profileCtrl",["$rootScope","$scope","$commonModel","$timeout","$tableName","$DTA",function(e,r,o,a,s,n){r.model=o,r.init=function(){var e=angular.fromJson(localStorage.user);r.model.username=e.username},r.saveUsername=function(e){var o={username:CryptoJS.SHA3(angular.copy(e.username),{outputLength:224}).toString()},a={idOffline:r.model.currentUser.idOffline};n.updateTable(r.model.db,s.Users,o,a);var l={username:e.username,password:angular.fromJson(localStorage.user).password};localStorage.user=angular.toJson(l)},r.savePassword=function(e){if(r.model.password==r.model.confirmPassword){var o={password:CryptoJS.SHA3(angular.copy(e.password),{outputLength:224}).toString()},a={idOffline:r.model.currentUser.idOffline};n.updateTable(r.model.db,s.Users,o,a);var l={username:angular.fromJson(localStorage.user).username,password:e.password};localStorage.user=angular.toJson(l)}}}]);
angular.module("starter").controller("settingCtrl",["$rootScope","$scope","$commonModel","$timeout","$ionicPopup","$commonFunc","$DTA","$tableName","$translate",function(e,n,a,o,l,t,i,d,r){n.model=a,n.setDefault=function(){var e={value:10},a={name:"maxCountLearn",createdBy:n.model.currentUser.idOnline};i.updateTable(n.model.db,d.Configs,e,a).then(function(e){n.model.maxCountLearn=10},function(e){})},n.saveConfig=function(){if(n.model.loading.show(),1==n.model.isChangeCountLearn){var e={value:n.model.maxCountLearn},a={name:"maxCountLearn",createdBy:n.model.currentUser.idOnline};i.updateTable(n.model.db,d.Configs,e,a)}if(1==n.model.isChangeLanguage){var o={value:n.model.languageItem},l={name:"languageLearn",createdBy:n.model.currentUser.idOnline};i.updateTable(n.model.db,d.Configs,o,l).then(function(e){n.model.loading.hide(),n.loadDataFromDb(n.model.db)},function(e){})}else n.model.loading.hide();r.use(n.model.languageDisplay)},n.clearData=function(){angular.isUndefined(n.showConfirmClearData)&&(n.showConfirmClearData=function(){var e=l.confirm({title:"Clear data",template:"All class and setting will be clear"});e.then(function(e){if(e){n.model.loading.show();var a=0,o=angular.copy(n.model.classes.length);n.model.classes.forEach(function(e,n){a++,t.removeClass(e,!1)}),setInterval(function(){a==o&&n.model.loading.hide()},1e3)}})}),n.showConfirmClearData()},n.changeCountLearn=function(){n.model.isChangeCountLearn=!0},n.changeLanguage=function(){n.model.isChangeLanguage=!0}}]);
angular.module("starter").controller("wordListLearnCtrl",["$rootScope","$scope","$commonModel","$timeout","$ionicPopover","$cordovaToast","$ionicModal","$tableName","$commonFunc","$DTA","$ionicScrollDelegate",function(e,o,n,t,a,r,i,l,s,d,c){o.model=n,o.showTestWord=function(e){o.model.currentVoca=angular.copy(e),o.model.testList=[],o.model.testList.push({index:0,word:e.english,tested:!1,lang:"english",mean:e.vietnamese}),o.model.testList.push({index:1,word:e.vietnamese,tested:!1,lang:"vietnamese",mean:e.english}),o.model.voca=o.model.testList[0],o.testWordModal?o.testWordModal.show():i.fromTemplateUrl("./templates/testWord.html",function(e){o.testWordModal=e,o.testWordModal.show()},{scope:o,animation:"slide-in-up",focusFirstInput:!1,backdropClickToClose:!1,hardwareBackButtonClose:!0}),setTimeout(function(){$("#inputTestMean").focus()},100)},o.showPopoverWordListLearn=function(e,n){e.stopPropagation(),o.itemWord=n,o.popoverWordListLearn?o.popoverWordListLearn.show(e):a.fromTemplateUrl("./templates/popupWordListLearn.html",{scope:o}).then(function(n){o.popoverWordListLearn=n,o.popoverWordListLearn.show(e)})},o.checkShowCompleteLesson=function(e){return e.some(function(e){return 1!=e.isRemember})},o.endLesson=function(){if(angular.isDefined(o.popoverModeTravel)&&o.popoverModeTravel.hide(),s.setView("#/main"),1!=o.model.currentLesson.state){var e={},n=o.model.lessonList.filter(function(e){return e.idOffline==o.model.currentLesson.idOffline});null!=n&&n.length>0&&(e=n[0]);var t=(new Date).toISOString();t=t.substr(0,10);var a,r,i=null;if(1!=e.isLearned&&0==e.state){var c=new Date(t).getTime(),m=c+864e5;i=new Date(m).toISOString(),i=i.substr(0,10),a={state:"1",learnStartDate:t,relearnDate:t,nextLearnDate:i,isLearned:"1",countLearn:(++e.countLearn).toString()}}else{var u=_.findIndex(o.model.fibonacci,{number:o.model.currentLesson.nextFibonaci}),p=null;if(u==o.model.fibonacci.length-1){p=Number(o.model.fibonacci[o.model.fibonacci.length-1].number)+Number(o.model.fibonacci[o.model.fibonacci.length-2].number),o.model.fibonacci.push({number:p});var f={isDeleted:"",deletedBy:"",number:p};d.insertDataToTable(o.model.db,l.Fibonacci,f)}else p=o.model.fibonacci[u+1].number;var c=new Date(t).getTime(),m=c+24*(p-e.nextFibonaci)*3600*1e3;i=new Date(m).toISOString(),i=i.substr(0,10),a={state:"1",relearnDate:t,nextLearnDate:i,isLearned:"1",nextFibonaci:p,countLearn:(++e.countLearn).toString()}}r={idOffline:e.idOffline},d.updateTable(o.model.db,"Lessons",a,r),angular.forEach(o.model.lessonList,function(e){e.idOffline==o.model.currentLesson.idOffline&&(e.state="1",e.nextLearnDate=a.nextLearnDate)}),angular.forEach(o.model.currentClass.lessons,function(e){e.idOffline==o.model.currentLesson.idOffline&&(e.state="1")})}},o.showAllWords=function(){o.model.wordList.forEach(function(e){e.isRemember=!1}),o.popoverModeTravel.hide()},o.speak=function(e){var n="http://translate.google.com/translate_tts?tl="+o.model.languages[o.model.languageLearn].value2+"&q=",t="&client=t";n+=encodeURIComponent(e.split("(")[0].toString())+t;var a=new Audio(n);a.onerror=function(n){var t=new SpeechSynthesisUtterance;window.speechSynthesis.getVoices();t.text=e.split("(")[0].toString(),t.lang=o.model.languages[o.model.languageLearn].value,t.onerror=function(e){r.show("Can't not play","short","bottom")},speechSynthesis.speak(t)},a.play()},o.checkMean=function(){if(1!=o.model.showNext){var e=o.model.voca.mean.split("(")[0],n=getSlug(e,{separator:" "}),t=getSlug(o.model.meaning,{separator:" "});n==t?(o.model.voca.tested=!0,o.model.wrong=!1):o.model.wrong=!0}else{o.model.meaning="",o.model.wrong=null;var a=o.model.testList.every(function(e){return 1==e.tested});if(a)return void(null!=o.model.currentVoca.example&&""!=o.model.currentVoca.example&&(o.model.isReadWord=!0,o.model.voca.word=angular.copy(o.model.currentVoca.example)));o.model.voca=o.model.testList[1-o.model.voca.index],o.model.voca.tested&&(o.model.voca=o.model.testList[1-o.model.voca.index])}o.model.showNext=!o.model.showNext,setTimeout(function(){$("#inputTestMean").focus()},100)},o.hideTestWord=function(){o.testWordModal.hide()},o.startSpeech=function(){if("webkitSpeechRecognition"in window){o.model.loading.show({template:'<span class="ion-ios-mic-outline"></span>'});var e=new webkitSpeechRecognition;e.lang=o.model.languages[o.model.languageLearn].value,e.onresult=function(e){e.results.length>0&&(o.model.speech=e.results[0][0].transcript,o.$digest(),o.model.isReadWord&&o.model.speech==o.model.voca?(o.model.wrong=!1,o.model.isReadWord=!1,o.model.loading.hide(),o.testWordModal.hide()):o.model.loading.hide())},e.onerror=function(e){o.model.loading.hide()},e.start(),t(function(){o.model.loading.hide()},1e4)}else r.show("Sorry, your Device does not support the Speech API","short","bottom")},o.hideVietnamese=function(){angular.forEach(o.model.wordList,function(e){e.isShowVietnamese=0}),o.popoverModeTravel.hide(),c.scrollTop(!0)},o.showVietnamese=function(){angular.forEach(o.model.wordList,function(e){e.isShowVietnamese=1}),o.popoverModeTravel.hide(),c.scrollTop(!0)},o.checkIfShowHideVietnamese=function(){return o.model.wordList.every(function(e){return 0==e.isShowVietnamese})}}]);
angular.module("starter").controller("wordsNotLearnYetCtrl",["$rootScope","$scope","$commonModel","$timeout","$ionicFilterBar","$controller","$ionicPopover","$ionicModal","$tableName","$DTA","$ionicPopup",function(o,e,r,t,l,a,n,s,c,d,i){e.model=r,a("allWordOfClassCtrl",{$scope:e}),e.init=function(){e.model.currentClass.vocabulary=null,e.model.search.$="",e.model.countCheck=0},e.showFilterBar=function(){e.popoverEdit&&e.popoverEdit.hide();l.show({items:e.model.currentClass.vocabulary,update:function(o,r){e.model.currentClass.vocabulary=o}})},e.checkToEdit=function(){e.model.countCheck=0,e.model.currentClass.vocabulary.forEach(function(o){1==o.check&&e.model.countCheck++})},e.showPopoverEdit=function(o){e.popoverEdit?e.popoverEdit.show(o):n.fromTemplateUrl("./templates/popoverEditWordNotYetLearn.html",{scope:e}).then(function(r){e.popoverEdit=r,e.popoverEdit.show(o)})},e.transferTo=function(){e.popoverEdit.hide(),e.transferToModal?e.transferToModal.show():s.fromTemplateUrl("./templates/modalTransferTo.html",function(o){e.transferToModal=o,e.transferToModal.show()},{scope:e,animation:"slide-in-up",focusFirstInput:!0,backdropClickToClose:!1,hardwareBackButtonClose:!1})},e.chooseClassTransfer=function(o){e.model.classTransfer=o},e.acceptTransfer=function(){for(var o=e.model.currentClass.vocabulary.length-1;o>=0;o--){var r=e.model.currentClass.vocabulary[o];if(1==r.check){var t={wordId:r.idOffline},l={classId:e.model.classTransfer.idOffline};d.updateTable(e.model.db,c.ClassesWords,l,t),e.model.currentClass.vocabulary.splice(o,1)}}e.transferToModal.hide()},e.cancelTransfer=function(){e.transferToModal.hide()},e.deleteTheseRows=function(){for(var o=e.model.currentClass.vocabulary.length-1;o>=0;o--){var r=e.model.currentClass.vocabulary[o];1==r.check&&e.removeWords(r)}},e.confirmDeleteRows=function(){e.popoverEdit.hide();var o=i.confirm({title:"Confirm delete!",template:"Are you sure you want to delete these rows?"});o.then(function(o){o&&e.deleteTheseRows()})}}]);